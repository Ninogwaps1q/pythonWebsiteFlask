{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/checkout.css') }}">
{% endblock %}

{% block content %}
<section class="checkout-section container">
    <h2 class="checkout-title">Checkout</h2>
    <p class="checkout-total">Total Amount: <strong>â‚±{{ '%.2f' | format(total) }}</strong></p>

    <form method="POST" action="{{ url_for('checkout') }}" class="checkout-form" onsubmit="return validateForm()">
        <div class="form-group">
            <label>Full Name:</label>
            <input type="text" name="fullname" value="{{ user.firstname }} {{ user.lastname }}" required>
        </div>

        <div class="form-group">
            <label>Delivery Address:</label>
            <input type="text" name="address" value="{{ user.address }}" required>
        </div>

        <div class="form-group">
            <label>Payment Method:</label>
            <select name="payment" required onchange="togglePaymentFields()">
                <option value="">--Select--</option>
                <option value="Cash on Delivery">Cash on Delivery</option>
                <option value="GCash">GCash</option>
                <option value="Credit/Debit Card">Credit/Debit Card</option>
            </select>
        </div>

        <div id="gcash-image" style="display:none; margin-top:10px;">
            <img src="{{ url_for('static', filename='images/payment.png') }}" alt="GCash Payment" style="max-width:200px;">
        </div>

        <div id="card-info" style="display:none; margin-top:10px;">
            <div class="form-group">
                <label>Name on Card:</label>
                <input type="text" name="card_name" placeholder="Cardholder Name">
            </div>
            <div class="form-group">
                <label>Card Number:</label>
                <input type="text" name="card_number" placeholder="XXXX-XXXX-XXXX-XXXX" maxlength="19" oninput="formatCardNumber(this)">
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-confirm">Confirm Order</button>
    </form>
</section>

<script>
function togglePaymentFields() {
    const paymentSelect = document.querySelector('select[name="payment"]');
    const cardInfo = document.getElementById('card-info');
    const gcashImage = document.getElementById('gcash-image');

    if (paymentSelect.value === "Credit/Debit Card") {
        cardInfo.style.display = 'block';
        gcashImage.style.display = 'none';
    } else if (paymentSelect.value === "GCash") {
        cardInfo.style.display = 'none';
        gcashImage.style.display = 'block';
    } else {
        cardInfo.style.display = 'none';
        gcashImage.style.display = 'none';
    }
}

function formatCardNumber(input) {
    let value = input.value.replace(/\D/g, '');
    value = value.substring(0, 16);
    const parts = [];
    for (let i = 0; i < value.length; i += 4) {
        parts.push(value.substring(i, i + 4));
    }
    input.value = parts.join('-');
}

function validateForm() {
    const paymentMethod = document.querySelector('select[name="payment"]').value;
    if (paymentMethod === "Credit/Debit Card") {
        const name = document.querySelector('input[name="card_name"]').value.trim();
        const number = document.querySelector('input[name="card_number"]').value.trim();
        if (!name || !number) {
            alert("Please fill in your card name and card number for Credit/Debit Card payment.");
            return false;
        }
    }
    return true;
}
</script>
{% endblock %}
